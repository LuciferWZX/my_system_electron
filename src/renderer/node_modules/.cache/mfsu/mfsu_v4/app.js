import "./stores";
import React from "react";
import { FocaProvider } from "foca";
import { getLocal } from "@/utils/store";
import { AppStorageKey, StorageKey } from "@/types/storageKey";
import userStore from "@/stores/user.store";
import appStore from "@/stores/app.store";
import { ENV } from "@/utils/constant";
import { getUserId } from "@/utils/help";
export const getInitialState = async () => {
  console.log("\u5F00\u59CB\u521D\u59CB\u5316\u6570\u636E");
  console.log(ENV);
  await initLocalSetting();
  await initUserInfo();
  console.log("\u521D\u59CB\u5316\u6570\u636E\u5B8C\u6210");
  return null;
};
export const rootContainer = (container) => {
  return React.createElement(FocaProvider, null, container);
};
const initUserInfo = async () => {
  const token = getLocal(StorageKey.token);
  if (token) {
    const id = getUserId(token);
    if (window.app_store) {
      const { getStore } = window.app_store;
      const users = await getStore(AppStorageKey.users);
      if (users) {
        const cacheUser = users[id];
        if (cacheUser) {
          await userStore.setUserInfo(cacheUser);
        }
      }
    }
  }
};
const initLocalSetting = async () => {
  const setting = getLocal(StorageKey.localSetting);
  if (setting) {
    appStore.updateState({
      theme: setting.theme,
      primaryColor: setting.primaryColor,
      fontSize: setting.fontSize
    });
  }
};
