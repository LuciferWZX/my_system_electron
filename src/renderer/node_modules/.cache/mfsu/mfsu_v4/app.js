import "./stores";
import React from "react";
import { FocaProvider } from "foca";
import { getLocal } from "@/utils/store";
import { StorageKey } from "@/types/storageKey";
import userStore from "@/stores/user.store";
import appStore from "@/stores/app.store";
export const getInitialState = async () => {
  console.log("\u5F00\u59CB\u521D\u59CB\u5316\u6570\u636E");
  await initLocalSetting();
  await initUserInfo();
  console.log("\u521D\u59CB\u5316\u6570\u636E\u5B8C\u6210");
  return null;
};
export const rootContainer = (container) => {
  return React.createElement(FocaProvider, null, container);
};
const initUserInfo = async () => {
  const token = getLocal(StorageKey.token);
  if (token) {
    if (window.app_db) {
      const { find } = window.app_db;
      const dbUsers = await find("users", {
        selector: {
          token
        },
        limit: 1
      });
      if (dbUsers.length > 0) {
        const cacheUser = dbUsers[0];
        await userStore.setUserInfo(cacheUser);
      }
    }
  }
};
const initLocalSetting = async () => {
  const setting = getLocal(StorageKey.localSetting);
  if (setting) {
    appStore.updateState({
      theme: setting.theme,
      primaryColor: setting.primaryColor,
      fontSize: setting.fontSize
    });
  }
};
